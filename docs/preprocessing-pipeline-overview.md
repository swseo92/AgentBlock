다음은 **전처리 파이프라인 개요** 문서를 최신 버전으로 수정한 내용입니다. 변경 사항을 반영하여 문서를 업데이트하였습니다.

### **수정된 문서**

# 전처리 파이프라인 Overview

본 문서는 프로젝트의 데이터 전처리 파이프라인에 대한 개요를 설명합니다. 이 파이프라인은 원본 데이터를 로드하고 전처리한 후, 임베딩 및 벡터스토어 저장으로 이어지는 전체 데이터 처리 흐름의 초기 단계를 담당합니다.

---

## 1. 전체 파이프라인 구성

전체 파이프라인은 다음 4단계로 구성됩니다:

1. **데이터 로더 (Loader Node)**
   - **입력**: 다양한 형식의 원본 데이터 (파일, API 응답, 텍스트 등)
   - **처리**: 데이터를 읽어 LangChain의 표준 `Document` 객체로 변환  
     (_각 Document에는 `page_content`와 `metadata`가 포함됩니다._)
   - **출력**: `list[Document]`

2. **전처리 (Preprocessing Node)**
   - **입력**: 데이터 로더에서 생성된 `list[Document]`
   - **처리**: 파서, 스플릿, 클리닝, 필터링 등 전처리 작업을 수행하여 문서 내용을 정제
   - **출력**: 전처리 완료된 `list[Document]`
   - **세부 사항**: 로더나 파서에서 생성된 메타데이터 구조를 그대로 유지합니다.

3. **임베딩 노드 (Embedding Node)**
   - **입력**: 전처리된 `list[Document]`
   - **처리**:
     - 각 Document의 `page_content`를 추출하여 `List[str]` 형태로 만듭니다.
     - LangChain의 `embed_documents()` 메서드를 사용해 임베딩 벡터를 계산합니다.
     - **출력**: 각 Document와 해당 임베딩 벡터를 **`{"document": doc, "vector": vector}`** 형태로 묶어,  
       `list[dict]` 구조로 반환합니다.

4. **벡터스토어 저장 노드 (Store Node)**
   - **입력**: 임베딩 노드의 출력 – 즉, `{"document": doc, "vector": vector}` 형태의 리스트
   - **처리**:
     - 각 Document에서 `page_content`와 `metadata`를 추출하고, 미리 계산된 임베딩 벡터와 함께 LangChain의 VectorStore (예: FAISS)에 저장합니다.
     - 예시로, FAISS의 `add_texts()` 메서드를 사용하여 텍스트, 메타데이터, 임베딩 벡터를 함께 인덱싱합니다.
   - **출력**: 저장 결과 (성공 여부, 삽입된 문서 개수 등)

---

## 2. LangGraph를 통한 파이프라인 구성

- 각 단계(데이터 로더, 전처리, 임베딩, 벡터스토어 저장)를 LangGraph의 노드 그래프로 구성하여, 
  - **검증**, **시각화**, **디버깅** 등의 기능을 활용할 수 있습니다.
- 초기에는 단일 배치로 전체 데이터를 처리하며, 추후 데이터 규모가 증가하면 배치 분할 또는 병렬 처리 전략을 추가할 수 있습니다.

---

## 3. 향후 고려 사항

1. **데이터 구조**  
   - 임베딩 결과와 원본 Document를 `{ "document": doc, "vector": vector }` 형태의 dict로 관리합니다.

2. **임베딩 모델 및 벡터스토어 선택**  
   - 초기에는 OpenAIEmbeddings와 FAISS를 예시로 사용하지만, 요구 사항에 따라 다른 모델이나 스토어로 확장이 가능합니다.

3. **배치 처리 전략**  
   - 초기 구현은 단일 배치로 진행하고, 이후 데이터 양에 따라 노드 내부에서 배치 분할 및 병렬 처리 로직을 도입할 예정입니다.

4. **메타데이터 유지**  
   - LangChain 로더와 파서에서 생성된 메타데이터를 그대로 활용하여, 나중에 검색 및 필터링에 사용할 수 있도록 합니다.

5. **세부 정책**  
   - 에러 처리, 중복 관리, 재인덱싱 정책 등은 전체 파이프라인을 개발한 후 테스트 및 사용 경험을 통해 구체적으로 결정할 수 있습니다.

---

## 결론

전처리 파이프라인은 **데이터 로더 → 전처리 → 임베딩 노드 → 벡터스토어 저장 노드**의 4단계로 구성되어 있습니다.  
특히, 임베딩 노드는 입력으로 `list[Document]`를 받아 각 Document의 텍스트를 임베딩한 후,  
`{"document": doc, "vector": vector}` 형태로 임베딩 결과를 보존하여 이후 벡터스토어 저장 단계에서  
원본 텍스트와 메타데이터를 함께 인덱싱할 수 있도록 설계되었습니다.

LangGraph를 사용해 이 전체 파이프라인을 그래프로 구성하면, 전체 데이터 흐름을 시각화하고 검증하는 데 큰 도움이 되며,  
추후 배치 처리 및 세부 정책 고도화에도 유연하게 대응할 수 있습니다.

---

### **수정된 내용**
- **전처리 파이프라인의 단계**: 각 단계에서의 처리 로직을 더 명확히 했습니다.
- **임베딩 노드**에 대한 설명이 구체화되었으며, **임베딩 벡터와 원본 문서를 어떻게 처리할지**에 대한 세부 사항을 추가했습니다.
- **향후 고려 사항**에서는 **배치 처리 전략**, **임베딩 모델 선택**, **메타데이터 처리** 등 중요한 요소들에 대한 내용을 추가했습니다.

위 내용을 기준으로 전처리 파이프라인 문서를 최신화했습니다.